---
import { type Lang, defaultLang, translations, languages } from '../i18n/translations';

interface Props {
  lang?: Lang;
}

const lang = Astro.props.lang ?? defaultLang;
const t = translations[lang].nav;
const base = import.meta.env.BASE_URL;

const navLinks = [
  { href: "#features", label: t.features },
  { href: "#comparison", label: t.comparison },
  { href: "#faq", label: t.faq },
  { href: "https://deepratai.github.io/cortex-knowledge-assistant", label: t.docs, external: true },
];
---

<header class="fixed top-0 left-0 right-0 z-50 glass border-b border-slate-700/50">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-20 sm:h-24 lg:h-28">
      <!-- Logo with actual image -->
      <a href={base} class="flex items-center gap-0 group">
        <img 
          src={`${base}/logo.png`}
          alt="Cortex Logo" 
          class="w-16 h-16 sm:w-20 sm:h-20 lg:w-28 lg:h-28 rounded-xl object-contain"
        />
        <span class="text-xl sm:text-2xl font-bold text-white group-hover:text-blue-400 transition-colors">Cortex</span>
      </a>
      
      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-8">
        {navLinks.map((link) => (
          <a 
            href={link.href}
            target={link.external ? "_blank" : undefined}
            rel={link.external ? "noopener noreferrer" : undefined}
            class="text-slate-300 hover:text-white transition-colors text-sm font-medium"
          >
            {link.label}
            {link.external && (
              <svg class="inline-block w-3 h-3 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            )}
          </a>
        ))}
      </div>
      
      <!-- Right Side: Language + CTAs -->
      <div class="hidden lg:flex items-center gap-4">
        <!-- Language Selector -->
        <div class="relative" id="lang-dropdown">
          <button 
            class="flex items-center gap-1.5 px-3 py-1.5 text-sm text-slate-300 hover:text-white transition-colors rounded-lg hover:bg-slate-800/50"
            id="lang-btn"
          >
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
            </svg>
            <span id="current-lang">{lang === 'es' ? 'ES' : 'EN'}</span>
            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div 
            class="hidden absolute right-0 mt-2 w-32 rounded-lg bg-slate-800 border border-slate-700 shadow-xl"
            id="lang-menu"
          >
            <a href={base} class="block px-4 py-2 text-sm text-slate-300 hover:text-white hover:bg-slate-700/50 rounded-t-lg">
              Espa√±ol
            </a>
            <a href={`${base}/en`} class="block px-4 py-2 text-sm text-slate-300 hover:text-white hover:bg-slate-700/50 rounded-b-lg">
              English
            </a>
          </div>
        </div>
        
        <!-- GitHub Link -->
        <a 
          href="https://github.com/DeepRatAI/cortex-knowledge-assistant"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center gap-2 text-slate-300 hover:text-white transition-colors text-sm font-medium"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          <span>{t.github}</span>
        </a>
        
        <!-- Demo CTA -->
        <a 
          href="https://cortex.deeprat.tech"
          target="_blank"
          rel="noopener noreferrer"
          class="px-4 py-2 bg-gradient-to-r from-blue-500 to-violet-500 text-white text-sm font-semibold rounded-lg hover:from-blue-600 hover:to-violet-600 transition-all shadow-lg shadow-blue-500/25"
        >
          {t.tryDemo}
        </a>
      </div>
      
      <!-- Mobile: Demo CTA + Menu Button -->
      <div class="flex lg:hidden items-center gap-3">
        <a 
          href="https://cortex.deeprat.tech"
          target="_blank"
          rel="noopener noreferrer"
          class="px-3 py-1.5 bg-gradient-to-r from-blue-500 to-violet-500 text-white text-sm font-semibold rounded-lg"
        >
          Demo
        </a>
        <button class="p-2 text-slate-300 hover:text-white hover:bg-slate-800/50 rounded-lg transition-colors" id="mobile-menu-btn" aria-label="Toggle menu">
          <svg class="w-6 h-6 hamburger-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg class="w-6 h-6 close-icon hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </nav>
  
  <!-- Mobile Menu - Enhanced -->
  <div class="hidden lg:hidden mobile-menu-panel" id="mobile-menu">
    <div class="px-4 py-6 space-y-1 bg-slate-900/95 backdrop-blur-lg border-t border-slate-700/50">
      {navLinks.map((link) => (
        <a 
          href={link.href}
          target={link.external ? "_blank" : undefined}
          class="flex items-center justify-between py-3 px-4 text-slate-300 hover:text-white hover:bg-slate-800/50 rounded-lg transition-all text-lg font-medium"
        >
          <span>{link.label}</span>
          {link.external && (
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          )}
        </a>
      ))}
      
      <!-- GitHub link mobile -->
      <a 
        href="https://github.com/DeepRatAI/cortex-knowledge-assistant"
        target="_blank"
        class="flex items-center gap-3 py-3 px-4 text-slate-300 hover:text-white hover:bg-slate-800/50 rounded-lg transition-all text-lg font-medium"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
        {t.github}
      </a>
      
      <!-- Language selector mobile -->
      <div class="pt-4 mt-4 border-t border-slate-700/50 flex items-center gap-4 px-4">
        <span class="text-sm text-slate-500">{t.language}:</span>
        <a href={base} class={`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${lang === 'es' ? 'bg-blue-500/20 text-blue-400' : 'text-slate-400 hover:text-white'}`}>
          ES
        </a>
        <a href={`${base}/en`} class={`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${lang === 'en' ? 'bg-blue-500/20 text-blue-400' : 'text-slate-400 hover:text-white'}`}>
          EN
        </a>
      </div>
    </div>
  </div>
</header>

<style>
  .mobile-menu-panel {
    animation: slideDown 0.2s ease-out;
  }
  
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  // Mobile menu toggle with icon swap
  const mobileBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerIcon = mobileBtn?.querySelector('.hamburger-icon');
  const closeIcon = mobileBtn?.querySelector('.close-icon');
  
  mobileBtn?.addEventListener('click', () => {
    const isHidden = mobileMenu?.classList.contains('hidden');
    mobileMenu?.classList.toggle('hidden');
    hamburgerIcon?.classList.toggle('hidden', !isHidden);
    closeIcon?.classList.toggle('hidden', isHidden);
  });
  
  // Close mobile menu when clicking on links
  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.add('hidden');
      hamburgerIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
    });
  });
  
  // Language dropdown toggle
  const langBtn = document.getElementById('lang-btn');
  const langMenu = document.getElementById('lang-menu');
  
  langBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    langMenu?.classList.toggle('hidden');
  });
  
  document.addEventListener('click', () => {
    langMenu?.classList.add('hidden');
  });
</script>
